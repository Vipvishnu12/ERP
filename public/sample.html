<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parent Portal</title>
</head>
<body>
  <h3>Welcome, Parent</h3>
  <div id="regnoButtons"></div>
  <hr>
  <div id="studentDetails"></div>

  <script>
    async function fetchSiblings(initialRegno) {
      const res = await fetch(`/api/children/${initialRegno}`);
      const data = await res.json();

      const container = document.getElementById("regnoButtons");
      container.innerHTML = "";

      // If no regno is selected, default to first sibling
      if (!localStorage.getItem("selectedRegno") && data.siblings.length > 0) {
        localStorage.setItem("selectedRegno", data.siblings[0].Reg_Number);
      }

      data.siblings.forEach(child => {
        const btn = document.createElement("button");
        btn.textContent = `${child.Reg_Number} - ${child.Name}`;
        btn.onclick = () => {
          const current = localStorage.getItem("selectedRegno");
          if (current !== child.Reg_Number) {
            localStorage.setItem("selectedRegno", child.Reg_Number);
            location.reload();
          }
        };
        container.appendChild(btn);
      });
    }

    async function loadStudentData() {
      const regno = localStorage.getItem("selectedRegno");
      if (!regno) return;

      const res = await fetch(`/api/siblingdata/${regno}`);
      const data = await res.json();

      document.getElementById("studentDetails").innerHTML = `
        <p><strong>Register Number:</strong> ${data[0].Reg_Number}</p>
        <p><strong>Name:</strong> ${data[0].Name}</p>
        <!-- Add more details if needed -->
      `;
    }

    // Entry point
    const fallbackRegno = "23CS092";
    fetchSiblings(fallbackRegno).then(loadStudentData);
  </script>
</body>
</html>
